# Модуль Управление фирмой франчайзи для 1С:УНФ 3.0

# Договоры

## Изменения

Методология модуля построена таким образом, что, по сути, все вращается вокруг договоров.
И в связи с этим, функционал договоров был значительно расширен: добавлено множество реквизитов, хотя многие из них скрываются настройками в тарифе, который указывается в договоре.
Также мы добавили возможность связывать договоры с событиями (звонки, письма и т.п.), добавили статусы и цены договоров.

# Как создать договор

1. Создать договор можно по кнопке "Создать" из формы списка договоров.
2. Укажите контрагента.
3. Укажите категорию договора. Если категории договоров не созданы, создайте их.
4. Укажите тариф. Если тарифов еще нет, создайте их.
5. Указав тариф отобразятся доступные реквизиты из тарифа. Предположим, что в настройках включены все реквизиты, опишем каждый из них:
    * Вид тарифа: если выбранный тариф разделяется на виды, то выберите его вид для детализации.
    * Пакет часов: если вы укажите пакет часов в договоре, то тогда цена договора будет определяться по пакету из договора, независимо от того, указан пакет в тарифе или нет.
    * Рег. №: регистрационный номер программного продукта 1С, на который оформляется договор.
    По кнопке "..." откроется список рег.номеров клиента, из которого можно выбран нужный номер.
    Если рег.номер еще не создан, то его можно создать по кнопке "Создать" (подробнее см. раздел "№№ программных продуктов").
    Если настроена интеграция с партнерским кабинетом, то информацию по рег.номеру можно посмореть по кнопке "Получить информацию о договоре по рег номеру" (буква i в окружности).
    * Вид оплаты: обозначает вид оплаты договора, либо помесячно, либо сразу.
    * Срок: количество месяцев от 1 до 36
    * Работают в 1С Фреш: обозначает, что договор заключается на подписку в сервис 1С:Фреш.
    * ИКЗ: Идентификационный код закупки, его можно указывать при работе с гос. учреждениями.
    * Дата начала и дата окончания: в этих датах указываются сроки договора.
    * С правой стороны договор можно связать с Расходной накладной или Заказом покупателя.

# Работа с отвалами

При окончании договора производится работа над продлением этого договора. И не всегда договор продляется, клиент может уйти по разным причинам. Для этого было добавлено поле "Причина отвала".

В этом поле перечислены возможные причины. Если указаны такие причины как: "Перешли к другому партнеру", "Вывод бухгалтерии на аутсорсинг", "Перешли на ПО другого вендора", то становится доступен реквизит "Конкурент", а также появляется такой реквизит как "Дата у конкурента". 
    
Дата у конкурента обозначает дату окончания договора у конкурента. Указав ее, вы сможете в "Отчете по тарифам" отслеживать договоры, которые заканчиваются у конкурентов.

 **Как узнать дату окончания у конкурента:**
 
 1. Вам должен быть известен рег.номер программы.
 2. Причина отвала должна быть равна "Перешли к другому партнеру".
 3. Дата окончания договора не должна сопадать с датой окончания договора у конкурента.
 4. Откройте форму с инфорацией о договоре по рег.номеру. 
 5. Появится кнопка "Изменить дату конкурента на ...". Нажав на нее в договоре в реквизит "Дата у конкурента" установится эта дата.

# Интеграция с 1С-Коннект

## Настройка интеграции

1. УФФ С&К -> Сервис -> Настройки подсистемы -> Настройки 1С-Коннект -> Создать.
2. Тип настроек = "Данные авторизации";
3. Установка Логина и Пароля.
Чтобы получить логин и пароль, нужно взять их из учетной системы 1С-Коннект. Если ранее не создавались учетные записи API, нужно создать учетную запись в Настройках API 1С-Коннект:
    * Учетная система 1С-Коннект (<https://cus.buhphone.com/>) -> Администрирование -> Настройки API -> Новая учетная запись.
    * Укажите название, логин и пароль и сохраните.
Созданный логин и пароль установите в созданных настройках 1С-Коннект.
4. УФФ С&К -> Справочники -> Линии поддержки -> Загрузить из 1С-Коннект.

## Импорт из 1С-Коннект

Создание записей в документе "Учет времени" на основе подключений по удаленному доступу из 1С-Коннект.

### Как работать

* УФФ С&К -> 1С-Коннект -> Импорт из 1С-Коннект
* Выберите получаемый период. **Внимание: При вызове операции в дневное время максимальное значение запрашиваемого периода не может превышать 60 календарных дней. Это особенность 1С-Коннект**
* Укажите номенклатуру, которая будет подставляться к создаваемым записям. Обычно это может быть услуга: например, оказание услуг по сопровождению.
* Нажмите на "Получить данные". Таблица заполнится списком подключений к клиентам за выбранный период.
Если комментарий к подключению не был указан в 1С-Коннект, его можно указать в списке.
Жирным шрифтом выделелены клиенты, у которых есть абонентский договор.
* Нажмите на "Создать документы". Создатся документ, в который внесутся работы из списка. Если в указанном периоде будет найден существующий документ, система предложит добавить данные в существующий документ.

## Интеграция параметров сопровождения

### Настройка интеграции

1. Должны быть заполнены авторизационные данные для доступа к API 1С-Коннект (см. Настройка интеграции).
2. Для выполнения настройки нужно, чтобы было доступно как минимум 4 свободных параметра 1С-Коннект.
Если все соответствует требованиям, выполните следующие действия:
УФФ С&К -> 1С-Коннект -> Параметры сопровождения 1С-Коннект -> Создать используемые дополнительные параметры.

### Передача параметров в 1С-Коннект

Выгрузка задолженности из 1С в 1С-Коннект.

Выгружаемые параметры:

**Стоимость услуг** - стоимость часа договора, рассчитывается по принципу, применяемому в отчете Учет рабочего времени.

**Задолженность** - значение задолженности по договорам клиента. Для корректного расчета в разделе "Настройки подсистемы" необходимо заполнить следующие настройки:

 *Дата начала получения договоров* - это дата, с которой отбираются все действующие договоры по текущий день.
 По этим договорам рассчитывается задолженность по документам.

 *Дата последней реализации* - это дата последнего выставленного документа "Расходная накладная" клиенту.
 На следующий день после этой даты рассчитывается задолженность по отработанному времени (см. отчет Учет рабочего времени).

Таким образом, расчет задолженности определяется следующим образом:
Задолженность по документам складывается с задолженностью по отработанному времени, которое начинается со следующего дня после последнего выставленного документа на оплату.

**Предоплата** - это значение, рассчитываемое аналогично задолженности по документам.

#### Как работать

* Для выгрузки задолженности нужно нажать на кнопку "Выгрузить задолженность". Если указать контрагента, то задолженность выгрузится только по нему, если значение пустое, то задолженность выгрузится по всем клиентам.

В таблице ниже отобразится информация о выгруженной задолженности.
В колонке "Сумма на дату реализации" отобразится задолженность по документам. То есть это задолженность рассчитанная программой.
В колонке "Сумма после даты реализации" отобразится задолженность по оказанным услугам клиенту уже после того, как был выставлен последний документ на оплату, т.е. задолженность по договору.

### Запрет на работу с клиентом

Рассылка сообщений об установке/снятии запрета на работу с клиентом. Рассылку можно делать как в линию к клиентам, так и в отдельно выделенную линию для сотрудников.

#### Настройка

Перейдите в УФФ С&К -> Сервис -> Настройки подсистемы -> Основные.

Для того, чтобы сообщения отправлялись клиентам в линию поддержки:

* Автор сообщений в 1С-Коннект -> Установите сотрудника.
При отправке сообщения автором сообщения будет указан установленный сотрудник.
Сотрудник из 1С сопоставится по Фамилии и дате рождения с пользователем из 1С-Коннект.

* Линия для отправки сообщений клиентам 1С-Коннект -> Выберите линию поддержки, куда отправлять сообщения клиентам. Тогда сообщения будут отправляться в линию поддержки для информирования клиентов.

* Линия для отправки сообщений сотрудникам 1С-Коннект -> Выберите линию поддержки, куда отправлять сообщения сотрудникам. Здесь вы можете выделить отдельную линию поддержки из 1С-Коннект так, чтобы ваши сотрудники получали поддержку в качестве пользователя, и доступ к этой линии иметь будут только они. Тогда при установленной настройке уведомления будут отправляться в эту линию для информирования сотрудников.

#### Как работать

Выберите клиента, кому нужно поменять статус. Снизу отобразится его текущий статус. Всего их 3:

 1. Работа разрешена;
 2. Работа запрещена;
 3. Не найден в 1С-Коннект.

Если клиент не найден в 1С-Коннект, то будет отображен статус "Не найден в 1С-Коннект".

Если нужно указать причину запрета, то она указывается в поле "Причина". Список причин берется из УФФ С&К -> Сервис -> Настройки подсистемы -> Причины запрета.

Можно заполнить поле Комментарий. Его значение отправится в линию поддержки с сотрудниками, но клиенту комментарий не отправится.

Если статус не менялся, отобразится статус "Работа разрешена".

Для установки запрета нужно нажать на кнопку "Установить запрет".
Для снятия запрета нужно нажать на кнопку "Снять запрет".
Уведомления отправятся в линию поддержки с сотрудниками, если настройка заполнена.
Также, если включен параметр "Уведомлять клиента", то сообщение отправится клиенту.

Если нужно отправить уведомления сразу нескольким клиентам, нужно нажать на кнопку в виде списка рядом с полем Контрагент. Тогда можно будет выбрать нескольких клиентов.

Кроме отправки уведомления в контрагенте изменится статус. Его значение будет отображено в карточке контрагента. Кроме статуса еще отобразится дата и время установки статуса.
Также статус будет отображен в карточке звонка.

 1. Синий цвет - работа разрешена.
 2. Красный цвет - работа запрещена.
 3. Ничего не написано - статус не менялся.
